{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://todoist-mcp.local/contracts/extract_response.schema.json",
  "title": "ExtractResponseV1",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schema_version",
    "intent",
    "confidence",
    "proposals"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "extract.v1"
    },
    "intent": {
      "type": "string",
      "enum": [
        "capture",
        "query",
        "mixed",
        "unclear"
      ]
    },
    "confidence": {
      "type": "number",
      "minimum": 0,
      "maximum": 1
    },
    "proposals": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "tasks",
        "problems",
        "goals",
        "links",
        "follow_up_questions"
      ],
      "properties": {
        "tasks": {
          "type": "array",
          "maxItems": 25,
          "items": {
            "$ref": "#/$defs/taskProposal"
          }
        },
        "problems": {
          "type": "array",
          "maxItems": 15,
          "items": {
            "$ref": "#/$defs/problemProposal"
          }
        },
        "goals": {
          "type": "array",
          "maxItems": 15,
          "items": {
            "$ref": "#/$defs/goalProposal"
          }
        },
        "links": {
          "type": "array",
          "maxItems": 50,
          "items": {
            "$ref": "#/$defs/linkProposal"
          }
        },
        "follow_up_questions": {
          "type": "array",
          "maxItems": 5,
          "items": {
            "type": "string",
            "minLength": 1,
            "maxLength": 240
          }
        }
      }
    },
    "notes": {
      "type": "array",
      "maxItems": 8,
      "items": {
        "type": "string",
        "maxLength": 240
      }
    }
  },
  "$defs": {
    "entityRef": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "key"
      ],
      "properties": {
        "id": {
          "type": "string",
          "minLength": 1
        },
        "key": {
          "type": "string",
          "minLength": 1,
          "maxLength": 120,
          "description": "Stable temporary key for intra-response references when id is unknown."
        }
      }
    },
    "taskProposal": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "action",
        "key",
        "content"
      ],
      "properties": {
        "action": {
          "type": "string",
          "enum": [
            "create",
            "update",
            "ignore"
          ]
        },
        "id": {
          "type": "string",
          "minLength": 1
        },
        "key": {
          "type": "string",
          "minLength": 1,
          "maxLength": 120
        },
        "content": {
          "type": "string",
          "minLength": 1,
          "maxLength": 240
        },
        "why": {
          "type": "string",
          "maxLength": 500
        },
        "status": {
          "type": "string",
          "enum": [
            "inbox",
            "open",
            "closed",
            "archived"
          ]
        },
        "priority": {
          "type": "integer",
          "minimum": 1,
          "maximum": 4
        },
        "impact": {
          "type": "integer",
          "minimum": 0,
          "maximum": 5
        },
        "due_date": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
        },
        "labels": {
          "type": "array",
          "maxItems": 20,
          "items": {
            "type": "string",
            "minLength": 1,
            "maxLength": 40
          }
        }
      }
    },
    "problemProposal": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "action",
        "key",
        "title"
      ],
      "properties": {
        "action": {
          "type": "string",
          "enum": [
            "create",
            "update",
            "ignore"
          ]
        },
        "id": {
          "type": "string",
          "minLength": 1
        },
        "key": {
          "type": "string",
          "minLength": 1,
          "maxLength": 120
        },
        "title": {
          "type": "string",
          "minLength": 1,
          "maxLength": 180
        },
        "description": {
          "type": "string",
          "maxLength": 600
        },
        "area": {
          "type": "string",
          "maxLength": 80
        },
        "active": {
          "type": "boolean"
        }
      }
    },
    "goalProposal": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "action",
        "key",
        "title"
      ],
      "properties": {
        "action": {
          "type": "string",
          "enum": [
            "create",
            "update",
            "ignore"
          ]
        },
        "id": {
          "type": "string",
          "minLength": 1
        },
        "key": {
          "type": "string",
          "minLength": 1,
          "maxLength": 120
        },
        "title": {
          "type": "string",
          "minLength": 1,
          "maxLength": 180
        },
        "category": {
          "type": "string",
          "maxLength": 80
        },
        "timeframe": {
          "type": "string",
          "maxLength": 80
        },
        "active": {
          "type": "boolean"
        }
      }
    },
    "linkProposal": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "from",
        "to",
        "relation"
      ],
      "properties": {
        "from": {
          "$ref": "#/$defs/entityRef"
        },
        "to": {
          "$ref": "#/$defs/entityRef"
        },
        "relation": {
          "type": "string",
          "enum": [
            "depends_on",
            "blocks",
            "supports_goal",
            "addresses_problem",
            "related"
          ]
        }
      }
    }
  }
}
