# Architectural Advisory: Project State & Risks (Feb 10, 2026)

**Role:** AI Technical Lead & Architect / Technical Advisor  
**Status:** Review of Phases 1-8 Implementation  

## Executive Summary
The project has established a high-quality deterministic core. The data models, planning algorithms, and observability hooks are robust and well-tested. However, the system currently lacks functional "intelligence" (LLM calls are mocked) and true multi-tenancy in its primary interface (Telegram).

## Key Findings & Risks

### 1. The "LLM Hole" (High Risk)
**Issue:** `backend/common/adapter.py` contains a `LLMAdapter` that uses basic string splitting (mock logic) instead of actual provider calls (Gemini/Grok).
**Impact:** The core value proposition—LLM-assisted thought capture and natural language plan explanation—is currently non-functional.
**Recommendation:** Implement the real provider integration in `adapter.py` as the immediate next priority. Ensure the extraction logic handles the strict JSON schema requirements defined in `docs/contracts/`.

### 2. Telegram Identity Hardcoding (High Risk)
**Issue:** The Telegram webhook and command handlers in `backend/api/main.py` hardcode `user_id = "usr_dev"`.
**Impact:** Multi-user support is broken at the interface level. Users cannot have isolated data via Telegram, and the Phase 7 auth mapping (`APP_AUTH_TOKEN_USER_MAP`) is bypassed.
**Recommendation:** 
- Create a `TelegramUserMap` table (or similar) to link Telegram `chat_id` to a system `user_id`.
- Implement a `/start <token>` flow to securely associate a Telegram chat with a project user.

### 3. State Divergence (Medium Risk)
**Issue:** Todoist sync is currently "one-way" (Local -> Todoist).
**Impact:** If a user completes a task directly in Todoist, the MCP system will still view it as open. This leads to "state drift" where the AI-generated plan becomes increasingly irrelevant.
**Recommendation:** 
- **Short term:** Add a "force pull" endpoint/command.
- **Medium term:** Implement Todoist webhooks or a periodic "Sync Pull" worker job to reconcile remote changes.

### 4. Interface Auth Inconsistency (Medium Risk)
**Issue:** API endpoints use Bearer tokens and rate limits (Phase 7), but the Telegram path has its own simplified logic and hardcoded IDs.
**Impact:** Inconsistent enforcement of quotas, cost tracking, and security policies.
**Recommendation:** Refactor identity resolution into a shared dependency or middleware that handles both Bearer tokens (for API) and `chat_id` lookups (for Telegram).

## Technical Debt & Hardening
- **Mock Cleanup:** Remove all "Phase 4 default" comments and placeholders.
- **Sync Safety:** Ensure the Todoist worker handles rate limits and API failures gracefully (retries are present, but backoff strategy should be monitored).
- **Metric Bounding:** The `/health/metrics` endpoint was recently hardened to avoid unbounded scans; ensure similar bounding is applied to any future "list" or "aggregate" queries.

## Recommended Next Steps
1. **Phase 9: Provider Realization.** Replace `LLMAdapter` mocks with production-ready provider calls.
2. **Phase 10: Identity Unification.** Implement `TelegramUserMap` and secure user-onboarding flows.
3. **Phase 11: Bi-directional Sync.** Implement Todoist -> Local reconciliation.

---
*Prepared by: Gemini Architect Agent*
